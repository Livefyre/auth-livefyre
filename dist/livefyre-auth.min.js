(function(e,t){if(typeof Livefyre=="object"&&typeof Livefyre.define=="function"&&Livefyre.define.amd)Livefyre.define([],t);else if(typeof define=="function"&&define.amd)define([],t);else{var n=t();e.Livefyre=e.Livefyre||{},e.Livefyre.auth=n}})(this,function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("inherits",[],function(){function e(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}return e.parasitically=function(t,n){var r=e.keys(n.prototype),i=r.length,s;for(var o=0;o<i;o++)s=r[o],t.prototype[s]||(t.prototype[s]=n.prototype[s])},e.keys=Object.keys||function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if(typeof i!="object"&&typeof i!="function"||i===null)throw new TypeError("Object.keys called on a non-object");var s=[];for(var o in i)e.call(i,o)&&s.push(o);if(t)for(var u=0;u<r;u++)e.call(i,n[u])&&s.push(n[u]);return s}}(),e}),n("event-emitter",["require","exports","module"],function(e,t,n){function s(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var r=Array.prototype.slice,i=n.exports=function(){this._listeners={}};i.listenerCount=function(e,t){var n=e._listeners[t];return n?n.length:0},i.prototype.on=function(e,t){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),this},i.prototype.addListener=i.prototype.on,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n)},i.prototype.removeListener=function(e,t){if(t&&this._listeners[e]){var n=s(this._listeners[e],t);if(n===-1)return;this._listeners[e].splice(n,1)}},i.prototype.emit=function(e){var t=this._listeners[e]||[],n=r.call(arguments,1),i;t.length&&(t=t.slice());if(e==="error"&&!t.length)throw i=n[0],i instanceof Error?i:TypeError('Uncaught, unspecified "error" event');for(var s=0,o=t.length;s<o;s++)try{t[s].apply(this,n)}catch(i){switch(e){case"error":try{this.emit("errorOnError",i)}catch(u){throw new Error("event-emitter: There was an exceptionin the errorInOnError listener",i,this)}break;default:this.emit("error",i)}}}}),n("debug",["require","exports","module"],function(e,t,n){function r(e){return r.enabled(e)?function(t){t=i(t);var n=new Date,s=n-(r[e]||n);r[e]=n,t=e+" "+t+" +"+r.humanize(s),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function i(e){return e instanceof Error?e.stack||e.message:e}n.exports=r,r.names=[],r.skips=[],r.enable=function(e){try{localStorage.debug=e}catch(t){}var n=(e||"").split(/[\s,]+/),i=n.length;for(var s=0;s<i;s++)e=n[s].replace("*",".*?"),e[0]==="-"?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$"))},r.disable=function(){r.enable("")},r.humanize=function(e){var t=1e3,n=6e4,r=60*n;return e>=r?(e/r).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},r.enabled=function(e){for(var t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(var t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1};try{window.localStorage&&r.enable(localStorage.debug)}catch(s){}}),n("auth/util/bind",["require","exports","module"],function(e,t,n){n.exports=function(e,t,n){if(!e)throw new Error;if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}}),n("auth/auth",["require","exports","module","inherits","event-emitter","debug","./util/bind"],function(e,t,n){function a(e){return e instanceof Error?e:null}function f(e,t){var n=0;return t=t||{},function(){n++;if(n>1){s(["This function is only meant to be called once, but it was called ",n," times"].join(""));return}e.apply(t,arguments)}}var r=e("inherits"),i=e("event-emitter"),s=e("debug")("auth"),o=e("./util/bind"),u=n.exports=function(){var e=!1,t,n=!1;i.apply(this),this._delegate=!1;var r=function(n){return n?t&&t[n]:t};this.on("login",function(i){t=i,e=!0,n=!0}),this.on("authenticate",function(){n=!0}),this.on("logout",function(){t=null,e=!1,n=!1}),this.on("error",function(e){s(e)}),this.get=r,this.isAuthenticated=function(){return n}};r(u,i),u.prototype.delegate=function(e){return s("Auth#delegate",e),this._delegate={},e.login&&(this._delegate.login=o(e.login,e)),e.logout&&(this._delegate.logout=o(e.logout,e)),e.viewProfile&&(this._delegate.viewProfile=o(e.viewProfile,e)),e.editProfile&&(this._delegate.editProfile=o(e.editProfile,e)),e.forEachAuthentication&&e.forEachAuthentication(o(function(e){this._authenticate(e)},this)),this.emit("delegate",e),this},u.prototype.hasDelegate=function(e){return typeof e=="string"?this._delegate&&this._delegate.hasOwnProperty(e):!!this._delegate},u.prototype.login=function(e){if(e&&typeof e!="function")return this._loginUser(e);var t=e;s("Auth#login");var n=this._delegate.login,r=o(f(function(){this._finishLogin.apply(this,arguments),typeof t=="function"&&t.apply(this,arguments)},this));n(r)},u.prototype._loginUser=function(e){this.emit("login",e);for(var t in e)e.hasOwnProperty(t)&&this.emit("login."+t,e[t])},u.prototype._finishLogin=function(e,t){s("Auth#_finishLogin",e,t);if(e){this.emit("error",e);return}t||s(["_finishLogin called without a truthy second parameter. The user","cannot be authenticated."].join(" ")),this._authenticate(t)},u.prototype.logout=function(e){s("Auth#logout");var t=this._delegate.logout,n=new Error("No logout auth delegate");if(!t){if(typeof e!="function")throw n;e(n);return}var r=o(f(function(){this._finishLogout.apply(this,arguments),typeof e=="function"&&e.apply(this,arguments)},this));t(r)},u.prototype._finishLogout=function(e,t){s("Auth#_finishLogout",t);if(e){this.emit("error",e);return}this.emit("logout")},u.prototype.authenticate=function(e){this._authenticate(e)},u.prototype._authenticate=function(e){if(!e)return;for(var t in e)e.hasOwnProperty(t)&&this.emit("authenticate."+t,e[t]);this.emit("authenticate",e)},u.prototype.viewProfile=function(e){this._delegate.viewProfile(e)},u.prototype.editProfile=function(e){this._delegate.editProfile(e)},u.prototype.plugin=function(e){return e(this),this}}),n("auth/main",["require","exports","module","./auth"],function(e,t,n){var r=e("./auth"),i=function(e){return new r(e)};t=n.exports=i(),t.create=i}),n("auth",["auth/main"],function(e){return e}),n("base64",["require","exports","module"],function(e,t,n){function s(e){this.message=e}var r={},i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.prototype=new Error,s.prototype.name="InvalidCharacterError",r.btoa=window.btoa?function(e){return window.btoa(e)}:function(e){for(var t,n,r=0,o=i,u="";e.charAt(r|0)||(o="=",r%1);u+=o.charAt(63&t>>8-r%1*8)){n=e.charCodeAt(r+=.75);if(n>255)throw new s("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return u},r.atob=window.atob?function(e){return window.atob(e)}:function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw new s("'atob' failed: The string to be decoded is not correctly encoded.");for(var t=0,n,r,o=0,u="";r=e.charAt(o++);~r&&(n=t%4?n*64+r:r,t++%4)?u+=String.fromCharCode(255&n>>(-2*t&6)):0)r=i.indexOf(r);return u},r.url={btoa:function(e){var t=r.btoa(e);return t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t},atob:function(e){var t=e;return t=t.replace(/-/g,"+"),t=t.replace(/_/g,"/"),r.atob(t)}},n.exports=r}),n("livefyre-auth/collection-authorization",["require","exports","module"],function(e,t,n){n.exports=function(t){this.collection=t,this.authors=[],this.moderatorKey=null}}),n("mout/function/identity",[],function(){function e(e){return e}return e}),n("mout/function/prop",[],function(){function e(e){return function(t){return t[e]}}return e}),n("mout/object/hasOwn",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return e}),n("mout/object/forIn",["./hasOwn"],function(e){function r(){n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],t=!0;for(var e in{toString:null})t=!1}function i(i,o,u){var a,f=0;t==null&&r();for(a in i)if(s(o,i,a,u)===!1)break;if(t){var l=i.constructor,c=!!l&&i===l.prototype;while(a=n[f++])if((a!=="constructor"||!c&&e(i,a))&&i[a]!==Object.prototype[a]&&s(o,i,a,u)===!1)break}}function s(e,t,n,r){return e.call(r,t[n],n,t)}var t,n;return i}),n("mout/object/forOwn",["./hasOwn","./forIn"],function(e,t){function n(n,r,i){t(n,function(t,s){if(e(n,s))return r.call(i,n[s],s,n)})}return n}),n("mout/lang/kindOf",[],function(){function r(r){return r===null?"Null":r===n?"Undefined":e.exec(t.call(r))[1]}var e=/^\[object (.*)\]$/,t=Object.prototype.toString,n;return r}),n("mout/lang/isKind",["./kindOf"],function(e){function t(t,n){return e(t)===n}return t}),n("mout/lang/isArray",["./isKind"],function(e){var t=Array.isArray||function(t){return e(t,"Array")};return t}),n("mout/object/deepMatches",["./forOwn","../lang/isArray"],function(e,t){function n(e,t){var n=-1,r=e.length;while(++n<r)if(s(e[n],t))return!0;return!1}function r(e,t){var r=-1,i=t.length;while(++r<i)if(!n(e,t[r]))return!1;return!0}function i(t,n){var r=!0;return e(n,function(e,n){if(!s(t[n],e))return r=!1}),r}function s(e,n){return e&&typeof e=="object"?t(e)&&t(n)?r(e,n):i(e,n):e===n}return s}),n("mout/function/makeIterator_",["./identity","./prop","../object/deepMatches"],function(e,t,n){function r(r,i){if(r==null)return e;switch(typeof r){case"function":return typeof i!="undefined"?function(e,t,n){return r.call(i,e,t,n)}:r;case"object":return function(e){return n(e,r)};case"string":case"number":return t(r)}}return r}),n("mout/array/filter",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=[];if(t==null)return i;var s=-1,o=t.length,u;while(++s<o)u=t[s],n(u,s,t)&&i.push(u);return i}return t}),n("livefyre-auth/util/jsonp",["require","exports","module"],function(e,t,n){function r(e,t){function s(){r.parentNode&&r.parentNode.removeChild(r),window[n]=undefined}var n="_lfcallback_"+ +(new Date),r=document.createElement("script"),i=e.indexOf("?")>0?"&":"?";window[n]=function(e){s(),t(null,e)},r.type="text/javascript",r.async=!0,r.onerror=function(){s(),t("error")},r.src=e+i+"callback="+n,document.getElementsByTagName("head")[0].appendChild(r)}n.exports={req:r}}),n("mout/array/map",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=[];if(t==null)return i;var s=-1,o=t.length;while(++s<o)i[s]=n(t[s],s,t);return i}return t}),n("livefyre-auth/auth-api",["require","exports","module","base64","./collection-authorization","mout/array/filter","./util/jsonp","mout/array/map"],function(e,t,n){function f(e){var t=e&&e.code;if(t===200)return;var n=new Error("Error requesting with JSONP");return n.response=e,n.code=t,n}function l(e){var t=[].slice.call(arguments,1),n;for(var r=0,i=t.length;r<i;r++){n=t[r];for(var s in n){if(!n.hasOwnProperty(s))continue;e[s]=n[s]}}return e}function c(e,t){var n="{key}={value}".replace("{key}",e).replace("{value}",encodeURIComponent(t));return n}function h(e){var t=e.split(".");if(t.length!==3)throw new Error("The provided lftoken is not a JWT: "+e);var n=r.atob(t[1]),i=JSON.parse(n),s=i.domain;return s}function p(e){return e.split(".")[0]}function d(e){var t=p(e),n=document.location.protocol!=="http:"?"https:":document.location.protocol;return t==="livefyre"?n+"//"+"admin."+e:n+"//"+t+".admin.fyre.co"}function v(e){var t=h(e);return d(t)}var r=e("base64"),i=e("./collection-authorization"),s=e("mout/array/filter"),o=e("./util/jsonp"),u=e("mout/array/map"),a=n.exports={};a.authenticate=function(e,t){var n=[],i=e&&e.token,s=e&&e.serverUrl,o,u;i&&n.push(c("lftoken",e.token)),e.network&&(s=d(e.network)),s||(s=i?v(i):"http://livefyre.com"),e.bpChannel&&n.push(c("bp_channel",e.bpChannel)),e.articleId&&e.siteId&&n.push(c("articleId",r.btoa(e.articleId)),c("siteId",e.siteId)),o=n.join("&"),u=[s,"/api/v3.0/auth/?",o].join(""),this._request(u,function(e,n){e||(e=f(n));var r=n&&n.data;t(e,r)})},a._request=function(e,t){o.req(e,t)},a.updateUser=function(e,t,n){var r=t.profile,i=t.token,o=i&&i.value,u=i&&new Date(+(new Date)+i.ttl*1e3),a=t.collection_id,f,c=l({},r,{serverUrl:t.serverUrl,token:o,tokenExpiresAt:u});e.set(c);var h=[];a&&(f=this.createCollectionAuthorization(n||{},t),f&&h.push(f));var p=this.createNetworkAuthorizations(t);p.length>0&&h.push.apply(h,p);var d=this.createSiteAuthorizations(t);d.length>0&&h.push.apply(h,d);var v=s(h,function(t){return t.network?!e.isMod({network:t.network}):t.siteId?!e.isMod({siteId:t.siteId}):t.collection&&t.collection.id?!e.isMod({collectionId:t.collection.id}):!1});return v.length>0&&e.authorizations.push.apply(e.authorizations,v),e},a.createCollectionAuthorization=function(e,t){var n={network:e.network,id:t.collection_id,siteId:e.siteId,articleId:e.articleId},r=new i(n),s=t.permissions,o=s&&s.authors;o&&o.length>0&&r.authors.push.apply(r.authors,o);var u=s&&s.moderator_key;return u&&(r.moderatorKey=u),r},a.createNetworkAuthorizations=function(e){var t=e.modScopes,n=t&&t.networks;if(!(n&&n.length>0))return[];var r=u(n,function(e){var t={network:e,moderator:!0};return t});return r},a.createSiteAuthorizations=function(e){var t=e.modScopes,n=t&&t.sites;if(!(n&&n.length>0))return[];var r=u(n,function(e){var t={siteId:e,moderator:!0};return t});return r}}),n("mout/array/slice",[],function(){function e(e,t,n){var r=e.length;t==null?t=0:t<0?t=Math.max(r+t,0):t=Math.min(t,r),n==null?n=r:n<0?n=Math.max(r+n,0):n=Math.min(n,r);var i=[];while(t<n)i.push(e[t++]);return i}return e}),n("mout/function/bind",["../array/slice"],function(e){function t(t,n,r){var i=e(arguments,2);return function(){return t.apply(n,i.concat(e(arguments)))}}return t}),n("mout/array/some",["../function/makeIterator_"],function(e){function t(t,n,r){n=e(n,r);var i=!1;if(t==null)return i;var s=-1,o=t.length;while(++s<o)if(n(t[s],s,t)){i=!0;break}return i}return t}),n("livefyre-auth/user",["require","exports","module","event-emitter","inherits","mout/array/some"],function(e,t,n){function o(e){this._attributes={},this.authorizations=[],r.call(this)}function u(e){var t=s(this.authorizations,function(t){var n=t.collection;return Boolean(n&&t.moderatorKey&&n.network===e.network&&n.siteId===e.siteId&&n.articleId===e.articleId)});return t}function a(e){var t=this.getAuthorizationByCollectionId(e);return Boolean(t&&t.moderatorKey)}function f(e){var t=s(this.authorizations,function(t){var n=t.network;return n&&n===e&&t.moderator});return t}function l(e){var t=s(this.authorizations,function(t){var n=t.siteId;return n&&n===e&&t.moderator});return t}var r=e("event-emitter"),i=e("inherits"),s=e("mout/array/some");i(o,r),o.EVENTS={CHANGE:"change"},o.prototype.set=function(e,t){var n,r,i;typeof e=="string"&&(n=e,e={},e[n]=t);for(r in e)e.hasOwnProperty(r)&&(i=e[r],this._attributes[r]=i,this.emit(o.EVENTS.CHANGE+":"+r,i));this.emit(o.EVENTS.CHANGE,e)},o.prototype.get=function(e){return e?this._attributes[e]:this._attributes},o.prototype.unset=function(e){if(e in this._attributes){delete this._attributes[e];var t={};t[e]=void 0,this.emit(o.EVENTS.CHANGE+":"+e,t[e])}},o.prototype.isAuthenticated=function(){return!!this.get("id")},o.prototype.getAuthorizationByCollectionId=function(e){var t,n;for(var r=0;r<this.authorizations.length;r++){t=this.authorizations[r],n=t.collection;if(n&&n.id===e)return t}return null},o.prototype.isMod=function(e){if(e.collectionId)return a.call(this,e.collectionId);if(e.articleId)return u.call(this,e);if(e.network)return f.call(this,e.network);if(e.siteId)return l.call(this,e.siteId);return},n.exports=o}),n("mout/lang/isPlainObject",[],function(){function e(e){return!!e&&typeof e=="object"&&e.constructor===Object}return e}),n("mout/object/mixIn",["./forOwn"],function(e){function t(t,r){var i=0,s=arguments.length,o;while(++i<s)o=arguments[i],o!=null&&e(o,n,t);return t}function n(e,t){this[t]=e}return t}),n("mout/lang/clone",["./kindOf","./isPlainObject","../object/mixIn"],function(e,t,n){function r(t){switch(e(t)){case"Object":return i(t);case"Array":return u(t);case"RegExp":return s(t);case"Date":return o(t);default:return t}}function i(e){return t(e)?n({},e):e}function s(e){var t="";return t+=e.multiline?"m":"",t+=e.global?"g":"",t+=e.ignorecase?"i":"",new RegExp(e.source,t)}function o(e){return new Date(+e)}function u(e){return e.slice()}return r}),n("mout/lang/deepClone",["./clone","../object/forOwn","./kindOf","./isPlainObject"],function(e,t,n,r){function i(t,r){switch(n(t)){case"Object":return s(t,r);case"Array":return o(t,r);default:return e(t)}}function s(e,n){if(r(e)){var s={};return t(e,function(e,t){this[t]=i(e,n)},s),s}return n?n(e):e}function o(e,t){var n=[],r=-1,s=e.length,o;while(++r<s)n[r]=i(e[r],t);return n}return i}),n("livefyre-auth/util/storage",["require","exports","module"],function(e,t,n){var r="__lfstorage__",i=function(){try{var e=localStorage||null;return e.setItem(r,"1"),e.removeItem(r),!0}catch(t){return!1}}(),s={set:function(e,t,n){var r={value:t,expiration:n||null};try{localStorage.setItem(e,JSON.stringify(r))}catch(i){}},get:function(e){try{var t=localStorage.getItem(e),n=t?JSON.parse(t):{};return n.expiration&&n.expiration<+(new Date)?(s.remove(e),undefined):n.value}catch(r){return undefined}},remove:function(e){try{localStorage.removeItem(e)}catch(t){}}},o={set:function(e,t,n){function r(e){return(new Date(e)).toUTCString()}var i,s,o=6048e5;n>0?i=r(n):n===0?i=";expires="+(new Date(1970,1,1)).toUTCString():i=+(new Date)+o,document.cookie=e+"="+JSON.stringify(t)+s},get:function(e){function t(){return document.cookie.split(/\s*;\s*/)}var n=e+"=",r=t();for(var i=0,s;s=r[i];++i){if(s.lastIndexOf(n,0)===0)return s.substr(n.length);if(s===e)return""}return undefined},remove:function(e){o.set(e,"",0)}};n.exports=i?s:o}),n("livefyre-auth/session",["require","exports","module","./auth-api","mout/lang/deepClone","./user","./util/storage"],function(e,t,n){var r=e("./auth-api"),i=e("mout/lang/deepClone"),s=e("./user"),o=e("./util/storage"),u="fyre-auth",a="fyre-authentication-creds",f=n.exports={get:function(){var e=o.get(u)||{};if(!e.token)return null;var t=new s;return r.updateUser(t,e),t},save:function(e,t){var n=i(e),r=e.token,s=+(new Date)+r.ttl*1e3;t&&(n.mod_map=t.get("modMap")),o.set(u,n,s);var f=e.token;f&&o.set(a,f.value,+(new Date)+f.ttl*1e3)},clear:function(){o.remove(u),o.remove(a)}}}),n("livefyre-auth/auth-adapters",["require","exports","module","auth","./auth-api","mout/function/bind","./user","./session"],function(e,t,n){function a(e){var t=typeof e.loginByCookie=="function",n=window.fyre&&typeof window.fyre.conv=="object";return!!t&&!!n}function f(e){var t=typeof e.restoreSession=="function",n=window.Livefyre&&typeof window.Livefyre.user=="object";return t&&n}function l(e){return a(e)||f(e)}function c(e){function u(e,t){typeof e=="function"&&e.apply(this,null,t)}function a(t){var n=new o;t.serverUrl=e.serverUrl,n=i.updateUser(n,t),r.login({livefyre:n})}function f(){r.emit("logout")}var t={},n=window.Livefyre;return n.user.on("login",a),n.user.on("logout",f),t.login=function(){var t=e.login;return function(r){t.call(e),n.user.once("login",function(e){u(r,[e])})}}(),t.logout=function(){var t=e.logout;return function(r){t.call(e),n.user.once("logout",function(){u(r)})}}(),t.viewProfile=s(e.viewProfile,e),t.editProfile=s(e.editProfile,e),t.destroy=function(){n.user.removeListener("login",a),n.user.removeListener("logout",f),e.destroy()},t}function h(e){function n(e,t){if(!t)return r.emit("logout");r.login({livefyre:u.get()})}function s(e){return{success:function(){typeof e=="function"&&e.apply(this,null,arguments)},failure:function(){typeof e=="function"&&e.apply(this,arguments)}}}var t=window.fyre;t.conv.user.on("change:token",n),t.conv.user.id&&(r.get("livefyre")||n(t.conv.user.get("token")));var i={success:function(){},failure:function(){}},o=Array.prototype.slice,a={};return a.login=function(){var t=e.login;return function(n){t.call(e,s(n))}}(),a.logout=function(){var t=e.logout;return function(n){t.call(e,i),n()}}(),a.viewProfile=function(){var t=e.viewProfile;return function(){var n=o.call(arguments);n.unshift(i),t.apply(e,n)}}(),a.editProfile=function(){var t=e.editProfile;return function(){var n=o.call(arguments);n.unshift(i),t.apply(e,n)}}(),a.destroy=function(){t.conv.user.off("change:token",n)},e.loginByCookie(i),a}function p(e){return f(e)?c(e):a(e)?h(e):e}var r=e("auth"),i=e("./auth-api"),s=e("mout/function/bind"),o=e("./user"),u=e("./session");n.exports={oldToNew:p,isOld:l}}),n("livefyre-auth/user-service",["require","exports","module","./auth-api","./user"],function(e,t,n){var r=e("./auth-api"),i=e("./user");t.fetch=function(e,t){var n=this._authApi||r;n.authenticate(e,function(r,s){if(r)return t(r);if(!s.profile)return r=new Error("fetch-user got empty auth response"),t(r);var o=new i;s.serverUrl=e.serverUrl,n.updateUser(o,s,e),t(null,o,s)})}}),n("livefyre-auth/auth-plugin",["require","exports","module","./auth-adapters","./user","debug","./session","./user-service"],function(e,t,n){var r=e("./auth-adapters"),i=e("./user"),s=e("debug")("livefyre-auth/auth-plugin"),o=e("./session"),u=e("./user-service");n.exports=function(e,t,n){function f(t){e.login({livefyre:t})}function c(){if(typeof fyre.conv.getDelegate=="function"){var t=fyre.conv.getDelegate();t&&!t.appkitMetaDelegate&&e.delegate(t)}}function h(){if(window.fyre&&window.fyre.conv&&typeof fyre.conv.ready=="function")return fyre.conv.ready(function(){c()}),!0}n=n||{};var a=n.userService||u,l=o.get();l&&f(l),e.on("authenticate.livefyre",function(e){if(!e)return;if(e instanceof i)return f(e);typeof e=="string"&&(e={token:e,serverUrl:t}),t&&!e.serverUrl&&(e.serverUrl=t),e.lftoken&&!e.token&&(e.token=e.lftoken),a.fetch(e,function(t,n,r){if(t){s("Error authenticating with credentials",e,t);return}o.save(r,n),f(n)})}),e.on("logout",function(){o.clear()}),e.delegate=function(t){return function(n){n=r.oldToNew(n),t.call(e,n)}}(e.delegate);var p=0;(function d(){p++;if(p>15||e.hasDelegate()||h())return;setTimeout(d,100*p)})()}}),n("livefyre-auth/livefyre-auth-delegate",["require","exports","module","./auth-adapters","./util/jsonp","./util/storage","./user-service","./session"],function(e,t,n){function c(e,t){if(!(this instanceof c))return new c(e,t);t=t||{},this.serverUrl=e,this.siteId=t.siteId}var r=e("./auth-adapters"),i=e("./util/jsonp"),s=e("./util/storage"),o=navigator.userAgent,u="fyre-auth",a=e("./user-service"),f=o.indexOf("Opera")>-1,l=e("./session");c.prototype.login=function(e){var t=this;this._popup(function(){t.restoreSession(function(t,n){e(t,{livefyre:n})})})},c.prototype._popup=function(e){function u(e){if(!e)return!1;try{return e.closed===!1}catch(t){if(f)return!0;throw t}}function a(e,t){if(!u(t)){clearInterval(o),e();return}}var t=this.serverUrl,n=t+"/auth/popup/login/",r="width=530;height=365;location=true;menubar=false;resizable=false;scrollbars=false",i="?start=true";this.siteId&&(i+="&site_id="+this.siteId);var s=window.open(n+i,"authWindow",r),o=setInterval(function(){a(e,s)},100)},c.prototype.logout=function(e){var t=this.serverUrl+"/auth/logout/ajax/?nocache="+(new Date).getTime();i.req(t,function(t,n){e(t,n)})},c.prototype.viewProfile=function(e){window.open(e.profileUrl,"_blank")},c.prototype.editProfile=function(){window.open(this.serverUrl+"/profile/edit/info/","_blank")},c.prototype.restoreSession=function(e){var t=s.get(u)||{};t.token?e(null,t.token.value):(s.remove(u),a.fetch({serverUrl:this.serverUrl},function(t,n,r){if(t)return e(t);l.save(r,n),e(null,n)}))},n.exports=c}),n("livefyre-auth/main",["require","exports","module","auth","./auth-plugin","./livefyre-auth-delegate","./user","./user-service","./auth-api"],function(e,t,n){var r=e("auth"),i=e("./auth-plugin");i(r),n.exports=t=r,t.createDelegate=e("./livefyre-auth-delegate"),t.User=e("./user"),t.userService=e("./user-service"),t.api=e("./auth-api"),t.authPlugin=i}),n("livefyre-auth",["livefyre-auth/main"],function(e){return e}),t("livefyre-auth")});